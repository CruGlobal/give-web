<div class="row">
  <div class="col-sm-12">
    <div class="form-group is-required" ng-class="{'has-error': ($ctrl.parentForm.addressCountry | showErrors) || $ctrl.loadingCountriesError}">
      <label translate>Country</label>
      <div class="form-group">
        <select class="form-control form-control-subtle"
                name="addressCountry" required
                ng-model="$ctrl.address.country"
                ng-options="v.name as v['display-name'] for v in $ctrl.countries | orderBy:'\'display-name\''"
                ng-change="$ctrl.refreshRegions($ctrl.address.country)"
                ng-disabled="$ctrl.addressDisabled">
        </select>
        <div role="alert" ng-if="$ctrl.loadingCountriesError">
          <div class="help-block" translate>There was an error loading the list of countries. If you continue to see this message, contact <a href="mailto:eGift@cru.org">eGift@cru.org</a> for assistance.
            <button id="retryButton1" type="button" class="btn btn-default btn-sm" ng-click="$ctrl.loadCountries()" translate>Retry</button></div>
        </div>
        <div role="alert" ng-messages="$ctrl.parentForm.addressCountry.$error" ng-if="($ctrl.parentForm.addressCountry | showErrors)">
          <div class="help-block" ng-message="required" translate>You must select a country</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-sm-12">
    <div class="form-group is-required" ng-class="{'has-error': ($ctrl.parentForm.addressStreetAddress | showErrors)}">
      <label translate>Address</label>
      <input type="text"
             class="form-control  form-control-subtle"
             name="addressStreetAddress"
             ng-model="$ctrl.address.streetAddress"
             required
             ng-maxlength="200"
             ng-disabled="$ctrl.addressDisabled">
      <div role="alert" ng-messages="$ctrl.parentForm.addressStreetAddress.$error" ng-if="($ctrl.parentForm.addressStreetAddress | showErrors)">
        <div class="help-block" ng-message="required" translate>You must enter an address</div>
        <div class="help-block" ng-message="maxlength" translate>This field cannot be longer than 200 characters</div>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-sm-12">
    <div class="form-group" ng-class="{'has-error': ($ctrl.parentForm.addressExtendedAddress | showErrors)}">
      <input type="text"
             class="form-control  form-control-subtle"
             name="addressExtendedAddress"
             ng-model="$ctrl.address.extendedAddress"
             ng-maxlength="100"
             ng-disabled="$ctrl.addressDisabled">
      <div role="alert" ng-messages="$ctrl.parentForm.addressExtendedAddress.$error" ng-if="($ctrl.parentForm.addressExtendedAddress | showErrors)">
        <div class="help-block" ng-message="maxlength" translate>This field cannot be longer than 100 characters</div>
      </div>
    </div>
  </div>
</div>
<div ng-if="$ctrl.address.country !== 'US'">
  <div class="row">
    <div class="col-sm-12">
      <div class="form-group" ng-class="{'has-error': ($ctrl.parentForm.intAddressLine3 | showErrors)}">
        <input type="text"
               class="form-control  form-control-subtle" name="intAddressLine3"
               ng-model="$ctrl.address.intAddressLine3"
               ng-maxlength="100"
               ng-disabled="$ctrl.addressDisabled">
        <div role="alert" ng-messages="$ctrl.parentForm.intAddressLine3.$error" ng-if="($ctrl.parentForm.intAddressLine3 | showErrors)">
          <div class="help-block" ng-message="maxlength" translate>This field cannot be longer than 100 characters</div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12">
      <div class="form-group" ng-class="{'has-error': ($ctrl.parentForm.intAddressLine4 | showErrors)}">
        <input type="text"
               class="form-control  form-control-subtle"
               name="intAddressLine4"
               ng-model="$ctrl.address.intAddressLine4"
               ng-maxlength="100"
               ng-disabled="$ctrl.addressDisabled">
        <div role="alert" ng-messages="$ctrl.parentForm.intAddressLine4.$error" ng-if="($ctrl.parentForm.intAddressLine4 | showErrors)">
          <div class="help-block" ng-message="maxlength" translate>This field cannot be longer than 100 characters</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div ng-if="$ctrl.address.country === 'US'">
  <div class="row">
    <div class="col-sm-12">
      <div class="form-group is-required" ng-class="{'has-error': ($ctrl.parentForm.addressLocality | showErrors)}">
        <label translate>City</label>
        <input type="text"
               class="form-control  form-control-subtle"
               name="addressLocality"
               ng-model="$ctrl.address.locality"
               required
               ng-maxlength="50"
               ng-disabled="$ctrl.addressDisabled">
        <div role="alert" ng-messages="$ctrl.parentForm.addressLocality.$error" ng-if="($ctrl.parentForm.addressLocality | showErrors)">
          <div class="help-block" ng-message="required" translate>You must enter a city</div>
          <div class="help-block" ng-message="maxlength" translate>This field cannot be longer than 50 characters</div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-6">
      <div class="form-group is-required" ng-class="{'has-error': ($ctrl.parentForm.addressRegion | showErrors) || $ctrl.loadingRegionsError}">
        <label translate>State / Region</label>
        <div class="form-group">
          <select class="form-control  form-control-subtle"
                  name="addressRegion" required
                  ng-model="$ctrl.address.region"
                  ng-options="v.name as v['display-name'] for v in $ctrl.regions | orderBy:'\'display-name\''"
                  ng-disabled="$ctrl.addressDisabled">
          </select>
          <div role="alert" ng-if="$ctrl.loadingRegionsError">
            <div class="help-block" translate>There was an error loading the list of regions/state. If you continue to see this message, contact <a href="mailto:eGift@cru.org">eGift@cru.org</a> for assistance.
              <button id="retryButton2" type="button" class="btn btn-default btn-sm" ng-click="$ctrl.refreshRegions($ctrl.address.addressCountry, true)" translate>Retry</button></div>
          </div>
          <div role="alert" ng-messages="$ctrl.parentForm.addressRegion.$error" ng-if="($ctrl.parentForm.addressRegion | showErrors)">
            <div class="help-block" ng-message="required" translate>You must select a state / region</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-6">
      <div class="form-group is-required" ng-class="{'has-error': ($ctrl.parentForm.addressPostalCode | showErrors)}">
        <label translate>Zip / Postal Code</label>
        <input type="text"
               class="form-control  form-control-subtle"
               name="addressPostalCode"
               ng-model="$ctrl.address.postalCode"
               required
               ng-pattern="/^\d{5}(?:[-\s]\d{4})?$/"
               ng-disabled="$ctrl.addressDisabled">
        <div role="alert" ng-messages="$ctrl.parentForm.addressPostalCode.$error" ng-if="($ctrl.parentForm.addressPostalCode | showErrors)">
          <div class="help-block" ng-message="required" translate>You must enter a zip / postal code</div>
          <div class="help-block" ng-message="pattern" translate>You must enter a valid US zip code</div>
        </div>
      </div>
    </div>
  </div>
</div>
